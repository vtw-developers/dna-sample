- route:
    id: sample
    auto-startup: true
    from:
      uri: direct://sample
      steps:
        - log: ${body}
        - to:
            uri: http://127.0.0.1:8090/dna/sample/persons?httpMethod=POST
        - unmarshal:
            json:
              library: Jackson
        - log: ${body}
        - set-header:
            name: person
            simple: ${body}
        - process:
            ref: incomeBracketProcessor
        - log: ${header.incomeBracket}
        - choice:
            when:
              - simple: ${header.person[gender]} == 'Female'
                steps:
                  - choice:
                      when:
                        - simple: ${header.person[job]} == 'self employment'
                          steps:
                            - set-header:
                                name: payment
                                simple: 지원금A
                        - simple: ${header.incomeBracket} >= 7
                          steps:
                            - set-header:
                                name: payment
                                simple: 지원금B
                        - simple: ${header.incomeBracket} >= 3
                          steps:
                            - set-header:
                                name: payment
                                simple: 지원금C
                      otherwise:
                        steps:
                          - set-body:
                              simple: 지원금 대상 아님
              - simple: ${header.person[gender]} == 'Male'
                steps:
                  - choice:
                      when:
                        - simple: ${header.person[job]} == 'self employment'
                          steps:
                            - set-header:
                                name: payment
                                simple: 지원금D
                        - simple: ${header.incomeBracket} >= 7
                          steps:
                            - set-header:
                                name: payment
                                simple: 지원금E
                        - simple: ${header.incomeBracket} >= 3
                          steps:
                            - set-header:
                                name: payment
                                simple: 지원금F
                      otherwise:
                        steps:
                          - set-header:
                              name: payment
                              simple: 지원금 대상 아님
            otherwise:
              steps:
                - set-header:
                    name: payment
                    simple: 지원금 대상 아님
        - process:
            ref: resultGenerateProcessor